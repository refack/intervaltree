Hacking intervaltree
====================

This is a developer's guide to modifying and maintaining `intervaltree`.

## Dependencies

* On a Mac, you will need [`brew`][brew].

* On Linux, you will need `apt-get`.

On all systems, Python 2.6, 2.7, 3.2, 3.3, 3.4 and 3.5 are needed to run the complete test suite.

### Single version of Python

If you don't have all the above versions of Python, these `make` features will be unavailable to you:

* `make` and `make test`
* `make pytest`
* `make upload` and `make release upload`
     

## Project structure

### `intervaltree`

The `intervaltree` directory has three main files:

* `intervaltree.py`
* `interval.py`
* `node.py`

`intervaltree.py` and `interval.py` contain the public API to `IntervalTree` and `Interval`. `node.py` contains the internal logic of the tree. For the theory of how this type of tree works, read the following:

* Wikipedia's [Interval tree][Wiki intervaltree] article
* Eternally Confuzzled's tutorial on [AVL balancing][Confuzzled AVL tree]
* Tyler Kahn's simpler, immutable [interval tree implementation][Kahn intervaltree] in Python
 
### `test`

All files ending with `_test.py` are detected and run whenever you run `make` or `make quicktest`. In those files, only functions beginning with `test_` are executed.

#### `test/data`
Some tests depend on having certain lists of `Interval`s. These are stored in the modules of `test/data`. Most of these modules only contain a `data` attribute, which is a list of tuples that is converted to a list of `Interval`s by `test/intervals.py`. You can access them by importing the dict of lists of `Interval`s `test.intervals.ivs`.

Other tests (like `test/issue25_test.py`) depend on having pre-constructed `IntervalTree`s. These are constructed by `test/intervaltrees.py` and can be accessed by importing `test.intervaltrees.trees`. This is a dict of callables that return `IntervalTree`s.

### `scripts`

Contains `testall.sh`, which runs all tests on all supported versions of Python.

### Dependency folders

* `pyandoc` and `pandoc` give the ability to convert README.md into rst format for PyPI.
* `docutils` and `bin` are created if `pip` could not install them system-wide without permissions. These are used to check the syntax of the converted rst README.
* `*.egg` are created by `PyTest` to fulfill testing dependencies
* `intervaltree.egg-info` is package metadata generated by `setup.py`.

### Other documentation files

* `HACKING.md` is this file.
* `README.md` contains public API documentation and credits.
* `README.rst` is generated from `README.md`.
* `CHANGELOG.md`
* `LICENSE.txt`

### Other code files

* `pyproject.toml` contains project metadata, dependencies, and build configuration.
* `uv.lock` locks dependency versions for reproducible builds.


## Testing

### Code

To run the tests in the `test` directory, run

    uv run pytest

To run tests with coverage:

    uv run pytest --cov=intervaltree --cov-report=html

This will generate an HTML coverage report in `htmlcov/index.html`.

### Testing with specific Python versions

To test with a specific Python version:

    uv run --python 3.10 pytest
    uv run --python 3.11 pytest
    uv run --python 3.12 pytest

### README

The README is tested automatically as part of the test suite via the `--doctest-glob=README.md` option configured in `pyproject.toml`.


## Cleaning

To clean up build artifacts and temporary files:

**On Windows:**

    del /s /q __pycache__ *.pyc *.pyo
    rmdir /s /q dist build *.egg-info htmlcov .pytest_cache

**On Mac/Linux:**

    rm -rf __pycache__ **/__pycache__ *.pyc *.pyo dist build *.egg-info htmlcov .pytest_cache


## Maintainers: Working with PyPI

### Building

To build the package for distribution:

    uv build

This creates both source distribution (`.tar.gz`) and wheel (`.whl`) files in the `dist/` directory.

### Publishing

To publish a new version to PyPI:

1. Update the version in `pyproject.toml`
2. Build the package: `uv build`
3. Publish to PyPI: `uv publish`

For testing on TestPyPI first:

    uv publish --publish-url https://test.pypi.org/legacy/

Then verify the package looks correct before publishing to production PyPI with `uv publish`.


[Confuzzled AVL tree]: http://www.eternallyconfuzzled.com/tuts/datastructures/jsw_tut_avl.aspx
[Wiki intervaltree]: http://en.wikipedia.org/wiki/Interval_tree
[Kahn intervaltree]: http://zurb.com/forrst/posts/Interval_Tree_implementation_in_python-e0K
